{
  "schemaVersion": 2,
  "phase": 7,
  "generatedAt": "2026-02-16T14:45:00Z",
  "commit": "500f5bd5",
  "branch": "claude2",
  "nodeVersion": "v25.6.0",
  "platform": "darwin/arm64",
  "commands": {
    "unit": "node --test test/unit/*.test.js",
    "e2e": "node --test --test-concurrency=1 test/e2e/*.test.js",
    "session": "npm run test:session"
  },
  "session": {
    "durationMs": 4627,
    "total": 178,
    "passed": 141,
    "failed": 37,
    "byType": {
      "chargen": { "total": 91, "passed": 90, "failed": 1 },
      "gameplay": { "total": 18, "passed": 1, "failed": 17 },
      "map": { "total": 10, "passed": 1, "failed": 9 },
      "special": { "total": 50, "passed": 49, "failed": 1 },
      "interface": { "total": 3, "passed": 1, "failed": 2 },
      "option_test": { "total": 6, "passed": 0, "failed": 6 }
    },
    "sentinelSessions": [
      {
        "session": "seed1_chargen_valkyrie.session.json",
        "type": "chargen",
        "passed": true,
        "note": "Chargen sentinel - valkyrie human female neutral"
      },
      {
        "session": "seed1_gameplay.session.json",
        "type": "gameplay",
        "passed": false,
        "note": "Gameplay sentinel - currently failing RNG divergence"
      },
      {
        "session": "seed72_map.session.json",
        "type": "map",
        "passed": true,
        "note": "Map sentinel - single depth, passing"
      },
      {
        "session": "seed1_special_castle.session.json",
        "type": "special",
        "passed": true,
        "note": "Special level sentinel - castle"
      },
      {
        "session": "interface_chargen.session.json",
        "type": "interface",
        "passed": true,
        "note": "Interface sentinel - chargen screen"
      }
    ],
    "knownFailures": {
      "gameplay": "All gameplay sessions fail with RNG divergence at step 0",
      "map": "Most map sessions fail with RNG divergence (themerms)",
      "special": "seed42_special_castle fails grid mismatch",
      "chargen": "seed300_chargen_tourist fails with totable error",
      "interface": "interface_options/startup fail RNG mismatch"
    }
  },
  "fileBaselines": {
    "js/headless_runtime.js": {
      "lines": 1486,
      "role": "Core game headless support + full replay API"
    },
    "test/comparison/session_runtime.js": {
      "lines": 1469,
      "role": "Session replay runtime with migration to core documented"
    },
    "test/comparison/session_helpers.js": {
      "lines": 41,
      "role": "Re-exports facade - game-unaware"
    },
    "test/comparison/comparators.js": {
      "lines": 250,
      "role": "Pure comparison functions with diagnostic formatters"
    },
    "test/comparison/session_loader.js": {
      "lines": 200,
      "role": "Session file loading - game-unaware"
    }
  },
  "unitTests": {
    "headless_replay_api.test.js": 43,
    "comparators.test.js": 17,
    "total": 60
  },
  "exitCriteria": {
    "phase0": "Baseline artifact exists for regression comparison",
    "phase0_achieved": true,
    "phase1": "Core exposes stable replay API",
    "phase1_achieved": true,
    "phase1_commit": "a0c36d92",
    "phase2": "Map/special generation uses core HeadlessGame.generateMapsWithRng",
    "phase2_achieved": true,
    "phase2_commit": "9d13f024",
    "phase3": "Startup/chargen uses core HeadlessGame.generateStartupWithRng",
    "phase3_achieved": true,
    "phase3_commit": "62746006",
    "phase4": "Core owns replay step semantics (count prefix, occupation)",
    "phase4_achieved": true,
    "phase4_commit": "3de5e40a",
    "phase5": "Harness documents migration path to core APIs",
    "phase5_achieved": true,
    "phase5_commit": "0c732b1f",
    "phase6": "Comparators include diagnostic context and formatters",
    "phase6_achieved": true,
    "phase6_commit": "500f5bd5",
    "phase7": "Final cleanup and documentation complete",
    "phase7_achieved": true
  },
  "coreReplayApiAdditions": [
    "HeadlessGame.start(seed, options)",
    "HeadlessGame.sendKey(key) / sendKeys(keys)",
    "HeadlessGame.getTypGrid() / getScreen() / getAnsiScreen()",
    "HeadlessGame.enableRngLogging() / getRngLog() / clearRngLog()",
    "HeadlessGame.teleportToLevel(depth) / revealMap()",
    "HeadlessGame.checkpoint(phase)",
    "HeadlessGame.replayStep(key, options)",
    "HeadlessGame.isCountPrefixDigit(key) / accumulateCountPrefix()",
    "HeadlessGame.generateMapsWithRng(seed, maxDepth)",
    "HeadlessGame.generateStartupWithRng(seed, options)",
    "HeadlessGame.getRoleIndex(roleName)",
    "extractTypGridFromMap(map)"
  ]
}
